SKIN = { }

SKIN.fontFrame		= "CombineControl.Window"
SKIN.fontTab		= "CombineControl.Window"

SKIN.GwenTexture	= Material( "gwenskin/GModDefault.png" );

SKIN.control_color 				= Color( 255, 255, 255, 255 )
SKIN.control_color_highlight	= Color( 150, 150, 150, 255 )
SKIN.control_color_active 		= Color( 255, 10, 10, 255 )
SKIN.control_color_bright 		= Color( 90, 90, 90, 255 )
SKIN.control_color_dark 		= Color( 40, 40, 40, 255 )

SKIN.Colours = {}

SKIN.Colours.Window = {}
SKIN.Colours.Window.TitleActive			= GWEN.TextureColor( 4 + 8 * 0, 508 )
SKIN.Colours.Window.TitleInactive		= GWEN.TextureColor( 4 + 8 * 1, 508 )

SKIN.Colours.Button = { }
SKIN.Colours.Button.Normal				= Color( 255, 255, 255, 255 );
SKIN.Colours.Button.Hover				= Color( 255, 255, 255, 255 );
SKIN.Colours.Button.Down				= Color( 255, 255, 255, 255 );
SKIN.Colours.Button.Disabled			= Color( 128, 128, 128, 255 );

SKIN.Colours.Tab = {}
SKIN.Colours.Tab.Active = {}
SKIN.Colours.Tab.Active.Normal			= GWEN.TextureColor( 4 + 8 * 4, 508 )
SKIN.Colours.Tab.Active.Hover			= GWEN.TextureColor( 4 + 8 * 5, 508 )
SKIN.Colours.Tab.Active.Down			= GWEN.TextureColor( 4 + 8 * 4, 500 )
SKIN.Colours.Tab.Active.Disabled		= GWEN.TextureColor( 4 + 8 * 5, 500 )

SKIN.Colours.Tab.Inactive = {}
SKIN.Colours.Tab.Inactive.Normal		= GWEN.TextureColor( 4 + 8 * 6, 508 )
SKIN.Colours.Tab.Inactive.Hover			= GWEN.TextureColor( 4 + 8 * 7, 508 )
SKIN.Colours.Tab.Inactive.Down			= GWEN.TextureColor( 4 + 8 * 6, 500 )
SKIN.Colours.Tab.Inactive.Disabled		= GWEN.TextureColor( 4 + 8 * 7, 500 )

SKIN.Colours.Label = { }
SKIN.Colours.Label.Default				= Color( 255, 255, 255, 255 );
SKIN.Colours.Label.Bright				= Color( 255, 255, 255, 255 );
SKIN.Colours.Label.Dark					= Color( 200, 200, 200, 255 );
SKIN.Colours.Label.Highlight			= Color( 255, 255, 255, 255 );

SKIN.Colours.Tree = {}
SKIN.Colours.Tree.Lines					= GWEN.TextureColor( 4 + 8 * 10, 508 ) ---- !!!
SKIN.Colours.Tree.Normal				= GWEN.TextureColor( 4 + 8 * 11, 508 )
SKIN.Colours.Tree.Hover					= GWEN.TextureColor( 4 + 8 * 10, 500 )
SKIN.Colours.Tree.Selected				= GWEN.TextureColor( 4 + 8 * 11, 500 )

SKIN.Colours.Properties = {}
SKIN.Colours.Properties.Line_Normal			= GWEN.TextureColor( 4 + 8 * 12, 508 )
SKIN.Colours.Properties.Line_Selected		= GWEN.TextureColor( 4 + 8 * 13, 508 )
SKIN.Colours.Properties.Line_Hover			= GWEN.TextureColor( 4 + 8 * 12, 500 )
SKIN.Colours.Properties.Title				= GWEN.TextureColor( 4 + 8 * 13, 500 )
SKIN.Colours.Properties.Column_Normal		= GWEN.TextureColor( 4 + 8 * 14, 508 )
SKIN.Colours.Properties.Column_Selected		= GWEN.TextureColor( 4 + 8 * 15, 508 )
SKIN.Colours.Properties.Column_Hover		= GWEN.TextureColor( 4 + 8 * 14, 500 )
SKIN.Colours.Properties.Border				= GWEN.TextureColor( 4 + 8 * 15, 500 )
SKIN.Colours.Properties.Label_Normal		= GWEN.TextureColor( 4 + 8 * 16, 508 )
SKIN.Colours.Properties.Label_Selected		= GWEN.TextureColor( 4 + 8 * 17, 508 )
SKIN.Colours.Properties.Label_Hover			= GWEN.TextureColor( 4 + 8 * 16, 500 )

SKIN.Colours.Category = {}
SKIN.Colours.Category.Header				= GWEN.TextureColor( 4 + 8 * 18, 500 )
SKIN.Colours.Category.Header_Closed			= GWEN.TextureColor( 4 + 8 * 19, 500 )
SKIN.Colours.Category.Line = {}
SKIN.Colours.Category.Line.Text				= GWEN.TextureColor( 4 + 8 * 20, 508 )
SKIN.Colours.Category.Line.Text_Hover		= GWEN.TextureColor( 4 + 8 * 21, 508 )
SKIN.Colours.Category.Line.Text_Selected	= GWEN.TextureColor( 4 + 8 * 20, 500 )
SKIN.Colours.Category.Line.Button			= GWEN.TextureColor( 4 + 8 * 21, 500 )
SKIN.Colours.Category.Line.Button_Hover		= GWEN.TextureColor( 4 + 8 * 22, 508 )
SKIN.Colours.Category.Line.Button_Selected	= GWEN.TextureColor( 4 + 8 * 23, 508 )
SKIN.Colours.Category.LineAlt = {}
SKIN.Colours.Category.LineAlt.Text				= GWEN.TextureColor( 4 + 8 * 22, 500 )
SKIN.Colours.Category.LineAlt.Text_Hover		= GWEN.TextureColor( 4 + 8 * 23, 500 )
SKIN.Colours.Category.LineAlt.Text_Selected		= GWEN.TextureColor( 4 + 8 * 24, 508 )
SKIN.Colours.Category.LineAlt.Button			= GWEN.TextureColor( 4 + 8 * 25, 508 )
SKIN.Colours.Category.LineAlt.Button_Hover		= GWEN.TextureColor( 4 + 8 * 24, 500 )
SKIN.Colours.Category.LineAlt.Button_Selected	= GWEN.TextureColor( 4 + 8 * 25, 500 )

SKIN.Colours.TooltipText = GWEN.TextureColor( 4 + 8 * 26, 500 )

SKIN.colTextEntryText			= Color( 255, 255, 255, 255 );
SKIN.colTextEntryTextHighlight	= Color( 255, 255, 255, 10 );
SKIN.colTextEntryTextCursor		= Color( 255, 255, 255, 255 );

SKIN.PrintName 		= "ZoneControl Inventory"
SKIN.Author 		= "rusty"
SKIN.DermaVersion	= 1

function SKIN:PaintButton(pnl, w, h)
	if pnl.ShortButton then
		kingston.gui.FindFunc(pnl, "Paint", "ShortButton", w, h)
		return
	end
	
	if pnl.LongButton then
		kingston.gui.FindFunc(pnl, "Paint", "LongButton", w, h)
		return
	end
end

function SKIN:PaintVScrollBar(pnl, w, h)
	surface.SetDrawColor(120,120,120,120)
	surface.DrawOutlinedRect(0,0,w,h)
end

function SKIN:PaintScrollBarGrip(pnl, w, h)
	kingston.gui.FindFunc(pnl, "Paint", "VBar", w, h)
end

function SKIN:PaintButtonUp(pnl, w, h)
	kingston.gui.FindFunc(pnl, "Paint", "VBarUp", w, h)
end

function SKIN:PaintButtonDown(pnl, w, h)
	kingston.gui.FindFunc(pnl, "Paint", "VBarDown", w, h)
end

function SKIN:PaintTextEntry(pnl, w, h)
	surface.SetDrawColor(200,200,200,120)
	surface.DrawOutlinedRect(0,0,w,h)
	
	pnl:DrawTextEntryText(pnl:GetTextColor(), pnl:GetHighlightColor(), pnl:GetCursorColor())
end

function SKIN:LayoutMenu( panel, w, h ) -- PerformLayout is called every frame.

end

function SKIN:PaintMenu(pnl, w, h)
	kingston.gui.FindFunc(pnl, "Paint", "Menu", w, h)
end

function SKIN:PaintMenuOption( panel, w, h )

	if( !panel.LaidOut ) then
	
		panel.LaidOut = true;
		panel:SetTextColor( Color( 172, 172, 172 ) );
		panel:SetFont( "CombineControl.ChatNormal" );
		panel:SizeToContents();
		panel:Center();
	
	end
	
	if( panel:IsHovered() ) then
	
		surface.SetDrawColor( Color( 152, 152, 152, 32 ) );
		surface.SetFont( panel:GetFont() );
		local tW,tH = surface.GetTextSize( panel:GetText() );
		surface.DrawRect( 30, 2, tW, tH );
		
	end

end

derma.DefineSkin( "zc_inventory", "rusty", SKIN );

local UVSKIN = {}
--UVSKIN.inv_mat = Material("kingston/inventory_panels")
UVSKIN.inv_mat = CreateMaterial("inventory_pnl", "UnlitGeneric", {
	["$basetexture"] = "kingston/inventory_panels",
	["$translucent"] = 1,
	["$vertexalpha"] = 1,
	["$vertexcolor"] = 1
})
UVSKIN.mp_screen_mat = Material("kingston/mp_screen_panels")
UVSKIN.common = Material("kingston/ui_common")

UVSKIN.InventoryBack = {
	u0 = 0.67,
	v0 = 0,
	u1 = 1,
	v1 = 0.75,
}

UVSKIN.EquipFrame = {
	u0 = 0.331,
	v0 = 0,
	u1 = 0.67,
	v1 = 0.75,
}

UVSKIN.Menu = {
	u0 = 0.712,
	v0 = 0.3926,
	u1 = 0.9305,
	v1 = 0.499,
}

UVSKIN.LongButton = {
	normal = {
		u0 = 0.333,
		v0 = 0.905,
		u1 = 0.57,
		v1 = 0.9275,
	},
	hover = {
		u0 = 0.333,
		v0 = 0.9285,
		u1 = 0.57,
		v1 = 0.951,
	},
	down = {
		u0 = 0.333,
		v0 = 0.951,
		u1 = 0.57,
		v1 = 0.975,
	},
}

UVSKIN.ShortButton = {
	normal = {
		u0 = 0,
		v0 = 0,
		u1 = 1,
		v1 = 1,
	},
	hover = {
		u0 = 0,
		v0 = 0,
		u1 = 1,
		v1 = 1,
	},
	down = {
		u0 = 0,
		v0 = 0,
		u1 = 1,
		v1 = 1,
	},
}

UVSKIN.VBarUp = {
	u0 = 0.12109,
	v0 = 0.1689,
	u1 = 0.1358,
	v1 = 0.1835,
}

UVSKIN.VBarDown = {
	u0 = 0.12109,
	v0 = 0.216,
	u1 = 0.1358,
	v1 = 0.2304,
}

UVSKIN.VBar = {
	u0 = 0.12109,
	v0 = 0.2,
	u1 = 0.1358,
	v1 = 0.2156,
}

UVSKIN.HealthBar = {
	u0 = 0.333,
	v0 = 0.7705,
	u1 = 0.5435,
	v1 = 0.7871,
}

UVSKIN.ProtectionBar = {
	u0 = 0.332,
	v0 = 0.7705,
	u1 = 0.449,
	v1 = 0.7871,
}

UVSKIN.ConditionBar = {
	u0 = 0.3326,
	v0 = 0.7578,
	u1 = 0.39,
	v1 = 0.7636,
}

UVSKIN.protection_info = {
	-- radiation
	[DMG_RADIATION] = {
		default = 1,
		pos_x = ScreenScaleH(27),
		pos_y = (ScrH() / 4.9),
	},
	-- chemical burn
	[DMG_ACID] = {
		default = 1,
		pos_x = ScreenScaleH(27),
		pos_y = (ScrH() / 5.99),
	},
	-- electric shock
	[DMG_SHOCK] = {
		default = 1,
		pos_x = ScreenScaleH(27),
		pos_y = (ScrH() / 7.64),
	},
	-- thermal
	[DMG_BURN] = {
		default = 1,
		pos_x = ScreenScaleH(27),
		pos_y = (ScrH() / 10.6),
	},
	-- psychic
	[DMG_PARALYZE] = {
		default = 1,
		pos_x = ScreenScaleH(133),
		pos_y = (ScrH() / 4.9),
	},
	-- rupture
	[DMG_SLASH] = {
		default = 1,
		pos_x = ScreenScaleH(133),
		pos_y = (ScrH() / 5.99),
	},
	-- bulletproof
	[DMG_BULLET] = {
		default = 1,
		pos_x = ScreenScaleH(133),
		pos_y = (ScrH() / 7.64),
	},
}

UVSKIN.LockedArtifactSlot = {
	u0 = 0.4668,
	v0 = 0.831,
	u1 = 0.523,
	v1 = 0.8876,
}

function UVSKIN:PaintInventoryFrame(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.inv_mat)
	surface.DrawTexturedRectUV(0, 0, w, h, self.InventoryBack.u0, self.InventoryBack.v0, self.InventoryBack.u1, self.InventoryBack.v1)
end

function UVSKIN:PaintEquipFrame(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.inv_mat)
	surface.DrawTexturedRectUV(0, 0, w, h, self.EquipFrame.u0, self.EquipFrame.v0, self.EquipFrame.u1, self.EquipFrame.v1)
	
	local x, y = pnl:GetPos()
	
	local u0 = x + ScreenScaleH(10.5)
	local v0 = h - (h / 3.87)
	local u1 = x + ScreenScaleH(10.5) + ScreenScaleH(143.5) * ( LocalPlayer():Health() / LocalPlayer():GetMaxHealth() )
	local v1 = h - (h / 3.87) + ScreenScaleH(11)
	
	render.SetScissorRect(u0, v0, u1, v1, true)
		surface.SetDrawColor(150, 25, 25, pnl:GetAlpha() * 255)
		surface.SetMaterial(self.inv_mat)
		surface.DrawTexturedRectUV(ScreenScaleH(10.5), h - (h / 3.87), ScreenScaleH(143.5), ScreenScaleH(11), self.HealthBar.u0, self.HealthBar.v0, self.HealthBar.u1, self.HealthBar.v1)
	render.SetScissorRect(u0, v0, u1, v1, false)

	local protection = {}
	for _,item in next, LocalPlayer().Inventory do
		if !item:GetVar("Equipped",false) then continue end
		if !item.GetArmorValues then continue end

		for m,n in next, item:GetArmorValues() do
			protection[m] = (protection[m] or ((self.protection_info[m] and self.protection_info[m].default) or 1)) * n
		end
	end
	
	for k,v in next, self.protection_info do
		if !protection[k] then continue end
		
		local u0 = x + v.pos_x
		local v0 = h - v.pos_y
		local u1 = x + v.pos_x + ScreenScaleH(82) - (ScreenScaleH(82) * protection[k])
		local v1 = h - v.pos_y + ScreenScaleH(12)
		
		render.SetScissorRect(u0, v0, u1, v1, true)
			surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
			surface.SetMaterial(self.inv_mat)
			surface.DrawTexturedRectUV(v.pos_x, v0, ScreenScaleH(82), ScreenScaleH(12), self.ProtectionBar.u0, self.ProtectionBar.v0, self.ProtectionBar.u1, self.ProtectionBar.v1)
		render.SetScissorRect(u0, v0, u1, v1, false)
	end
end

function UVSKIN:PaintVBar(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.common)
	surface.DrawTexturedRectUV(0, 0, w, h, self.VBar.u0, self.VBar.v0, self.VBar.u1, self.VBar.v1)
end

function UVSKIN:PaintVBarUp(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.common)
	surface.DrawTexturedRectUV(0, 0, w, h, self.VBarUp.u0, self.VBarUp.v0, self.VBarUp.u1, self.VBarUp.v1)
end

function UVSKIN:PaintVBarDown(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.common)
	surface.DrawTexturedRectUV(0, 0, w, h, self.VBarDown.u0, self.VBarDown.v0, self.VBarDown.u1, self.VBarDown.v1)
end

function UVSKIN:PaintGridSlot(pnl, w, h)
	surface.SetDrawColor(160,160,160,20)
	surface.DrawOutlinedRect(0,0,w,h)
end

function UVSKIN:PaintMenu(pnl, w, h)
	surface.SetDrawColor(255, 255, 255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.mp_screen_mat)
	surface.DrawTexturedRectUV(0, 0, w, h, self.Menu.u0, self.Menu.v0, self.Menu.u1, self.Menu.v1)
end

function UVSKIN:PaintLongButton(pnl, w, h)
	local state = self.LongButton.normal
	if pnl:IsHovered() then
		state = self.LongButton.hover
	end
	
	if pnl:IsDown() then
		state = self.LongButton.down
	end
	
	surface.SetDrawColor(255,255,255, pnl:GetAlpha() * 255)
	surface.SetMaterial(self.inv_mat)
	surface.DrawTexturedRectUV(0, 0, w, h, state.u0, state.v0, state.u1, state.v1)
end

function UVSKIN:PaintItemDurability(pnl, w, h, item)
	local x, y = pnl:LocalToScreen(0,0)
	local pos_x = w / 2 - ScreenScaleH(38.4) / 2
	local pos_y = h - ScreenScaleH(3.8)
	
	local u0 = x + pos_x
	local v0 = y + pos_y
	local u1 = x + pos_x + ScreenScaleH(39) * ( item:GetVar("Durability", 100) / 100 )
	local v1 = y + pos_y + ScreenScaleH(4)
	
	render.SetScissorRect(u0, v0, u1, v1, true)
		surface.SetDrawColor(255 - (255  * (item:GetVar("Durability", 100) / 100)), 200 * (item:GetVar("Durability", 100) / 100), 0, pnl:GetAlpha() * 255)
		surface.SetMaterial(self.inv_mat)
		surface.DrawTexturedRectUV(pos_x, pos_y, ScreenScaleH(38.4), ScreenScaleH(3.2), self.ConditionBar.u0, self.ConditionBar.v0, self.ConditionBar.u1, self.ConditionBar.v1)
	render.SetScissorRect(u0, v0, u1, v1, false)
end

function UVSKIN:PaintArtifactSlot(pnl, w, h)
	local artifact_slots
	local draw_locked
	for k,v in next, LocalPlayer().Inventory do
		if v.Base == "clothes" and v:GetVar("Equipped", false) then
			artifact_slots = v:GetArtifactSlots()
		end
	end
	
	if !artifact_slots or artifact_slots < 1 or pnl.SlotNumber > artifact_slots then
		draw_locked = true
	end
	
	if draw_locked then
		surface.SetDrawColor(255,255,255, pnl:GetAlpha() * 255)
		surface.SetMaterial(self.inv_mat)
		surface.DrawTexturedRectUV(0, 0, w, h, self.LockedArtifactSlot.u0, self.LockedArtifactSlot.v0, self.LockedArtifactSlot.u1, self.LockedArtifactSlot.v1)
	end
end

kingston.gui.RegisterSkin("zc_inventory", UVSKIN)

hook.Add("ScreenResolutionChanged", "STALKER.UpdateProtectionPositions", function()
	UVSKIN.protection_info = {
		-- radiation
		[DMG_RADIATION] = {
			default = 1,
			pos_x = ScreenScaleH(27),
			pos_y = (ScrH() / 4.9),
		},
		-- chemical burn
		[DMG_ACID] = {
			default = 1,
			pos_x = ScreenScaleH(27),
			pos_y = (ScrH() / 5.99),
		},
		-- electric shock
		[DMG_SHOCK] = {
			default = 1,
			pos_x = ScreenScaleH(27),
			pos_y = (ScrH() / 7.64),
		},
		-- thermal
		[DMG_BURN] = {
			default = 1,
			pos_x = ScreenScaleH(27),
			pos_y = (ScrH() / 10.6),
		},
		-- psychic
		[DMG_PARALYZE] = {
			default = 1,
			pos_x = ScreenScaleH(133),
			pos_y = (ScrH() / 4.9),
		},
		-- rupture
		[DMG_SLASH] = {
			default = 1,
			pos_x = ScreenScaleH(133),
			pos_y = (ScrH() / 5.99),
		},
		-- bulletproof
		[DMG_BULLET] = {
			default = 1,
			pos_x = ScreenScaleH(133),
			pos_y = (ScrH() / 7.64),
		},
	}
end)